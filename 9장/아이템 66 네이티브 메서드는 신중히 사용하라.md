# 아이템 66. 네이티브 메서드는 신중히 사용하라

발표일: 2025년 9월 12일

## 🧩 네이티브 메서드란?

C나 C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드를 말한다.

자바 네이티브 인터페이스(JNI : Java Native Interface)는 자바 프로그램이 네이티브 메서드를 호출하는 기술이다.

자바에서는 할 일(껍데기)만 선언을 하고 나머지는 JVM이 JNI(Java Native Interface) 를 통해 연결해준다.

```java
public class HelloJNI {
    // 네이티브 메서드 선언 -> 실제 구현 없이 선언만!
    public native void sayHello();

    // 네이티브 라이브러리 로드
    static {
        System.loadLibrary("hello");  // libhello.so (Linux) 또는 hello.dll (Windows)
    }

    public static void main(String[] args) {
        new HelloJNI().sayHello(); // 네이티브 메서드 호출
    }
}
```

`native` 키워드 = JVM이 직접 실행하는 게 아니라, 외부 코드(C/C++)에 있다는 표시

```c
#include <jni.h>
#include <stdio.h>
#include "HelloJNI.h"  // javac -h 로 생성되는 헤더파일

// 네이티브 메서드 구현
JNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv *env, jobject thisObj) {
    printf("Hello from C code!\n");
}
```

### 📋 **VM이 호출할 때 흐름**

1. 자바 `HelloJNI.main()` 실행
2. `sayHello()` 호출 → 자바 안에는 구현이 없으니 JVM이 JNI로 넘어감
3. `System.loadLibrary("hello")` 로 로드한 라이브러리 안에서 `Java_HelloJNI_sayHello` 함수 찾음
4. 그 C 함수를 실행 → 결과 출력

## 네이티브 메서드의 주요 쓰임

1️⃣ 레지스트리 같은 플랫폼 특화 기능 사용

자바 언어로 직접 다룰 수 없는 운영체제 고유 기능(예: Windows Registry, Linux 디바이스 파일 등)을 JNI를 통해 사용할 수 있게 해주는 것

2️⃣ 네이티브 코드로 작성된 기존 라이브러리를 사용

3️⃣ 성능개선 목적으로 성능에 결정적인 영향을 주는 영역만 따로 네이티브 언어로 작성

플랫폼 특화 기능을 활용하려면 네이티브 메서드를 사용해야 한다. 

하지만 자바의 발전으로 하부 플랫폼의 기능들을 점차 흡수하고 있기 때문에 네이티브 메서드를 사용할 필요가 계속 줄어들고 있다.

대체할 만한 자바 라이브러리가 없는 네이티브 라이브러리를 사용해야 할 때는 당연히 네이티브 메서드를 써야한다.

**성능을 개선할 목적으로 네이티브 메서드를 사용하는 것은 거의 권장하지 않는다.**

JVM의 발전으로 대부분의 작업에서 지금의 자바는 다른 플랫폼에 견줄만한 성능을 보인다.

## 네이티브 메서드의 단점

1. 네이티브 언어가 안전하지 않으므로 네이티브 메서드를 사용하는 애플리케이션 메모리 훼손 오류로부터 더 이상 안전하지 않다.
    
    → 버퍼 오버, 배열 오버,, 메모리
    
2. 자바보다 플랫폼을 많이 타서 이식성도 낮고, 디버깅도 더 어렵다.
3. 가비지 컬렉터가 네이티브 메모리는 자동 회수하지 못하고, 추적조차 할 수 없다.
4. 자바 코드와 네이티브 코드의 경계를 넘나들 때마다 비용도 추가된다.
5. 네이티브 메서드를 활용하기 위하여 자바 코드 사이의 ‘접착 코드’를 작성하는 것도 귀찮고, 가독성이 떨어지는 작업이다.